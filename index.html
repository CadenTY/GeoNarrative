<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="description" content="GeoNarrative Template" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>GeoNarrative Template</title>
    <link rel ="stylesheet" href ="css/main.css">
    <script src="https://unpkg.com/scrollama"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
</head>

<body>
    <section id="cover">
        <video class="fullscreen canvas-center" playsinline="" autoplay="" muted="" loop="">
            <source src="assets/hospital.mp4" type="video/mp4">
        </video>
        <div id="intro">
            <h1>Hospital Mapping in the US</h1>
            <h5>GEOG 458 LAB 7 | By Caden Henson </h5>
            <p>
                Hospitals are vital hubs that deliver healthcare and medical services to people across the nation.
                These medical institutions vary in specialization and size, ranging from local community based facilities
                all the way to large medical centers. They provide state of the art technology and facilities, supported and
                staffed by professionals in numerous fields to help resolve medical emergencies and to provide treatments.
                All across the US, hospitals are strategically placed to ensure adequate spatial distribution and accessibility
                to populations in all areas. Serving as pillars to the wellbeing and health of a society, hospitals are vital
                to the success of a population and our species as a whole. With my Geo-narrative story map, I aim to display
                the spatial distribution of these crucial institutions, analyzing patterns of their dispersion and shining light
                on the important role they play in supporting the public.
            </p>

            <div class="footnote">
                <span> To access Hospital data click on the Logo</span>
                <a target="_blank" href="https://hub.arcgis.com/datasets/geoplatform::hospitals/explore?location=44.563368%2C-116.502543%2C5.94"> <img src="img/hospital.jpeg" width="50px"></a>
            </div>
        </div>
    </section>

    <section id="geonarrative">
        <div id="storyboard">
            <div id="map"></div>
        </div>

        <article class="scene" data-scene="0">
            <h2>Loading County Polygons</h2>
                <p>For this Geo-narrative story map, we are going to be examining hospital spatial
                distribution within the United States. The map is showcasing county data so that we can examine
                hospital locations within relation to more specific areas. This will allow for more accuracy when analyzing trends
                and patterns that may exist. </p>
            <div id='textid'></div>
        </article>

        <article class="scene" data-scene="1">
            <h2>Hospital Data</h2>
                <p>Across the United States you can see a wide array of data points showing where hospitals are located
                and clustered. As of December 2023, there are 8,013 hospitals established within the nation according to the data
                    gathered from ArcGIS. These include a vast variety of hospital and medical center types, ranging in size and
                specialization. These hospitals play a crucial role in supporting the population within the US. On average,
                it was estimated that roughly 33.7 million people are admitted into hospitals each year. </p>
            <div id='tooltip'></div>
        </article>

        <article class="scene" data-scene="2">
            <h2>Examining Washington State </h2>
                <p> To get a better understanding of hospital spatial distribution I've decided to compare two different
                    cities/case studies. First, I have chosen to examine Washington State. Washington has a relatively large population,
                    especially in more urban areas and major cities like Seattle. Within these urban areas we can see a greater
                    number of hospitals and medical centers more closely clustered together. The further you go away from the urban,
                    the fewer hospitals you see clustered and the fewer hospitals you see in general which is to be expected.

                </p>
        </article>

        <article class="scene" data-scene="3">
            <h2> Examining California </h2>
                <p> In examining the state of California which is known to be home to a vast population in many areas, we can
                    see a trend emerging in hospital dispersion. Large cities such as Los Angeles, San Francisco, and Sacramento have
                    very dense hospital clusters. We can see a significant increase when compared to Seattle and this is likely
                    due to not only urban density but also population density. More people require more medical services and as such
                    more hospitals are required to support this growing population in California.
                </p>
        </article>

        <article class="scene" data-scene="4">
            <h2>Step 5: Summary & Findings</h2>
                <p> After analyzing the map and dispersion of hospitals throughout the US, its clear to see the patterns and trends
                that emerge. One of those patterns that we can see is the correlation between population density and hospital clusters.
                    Population density is one of the most deciding factors that influences where hospitals are located as
                a higher population density in general will require a sufficient amount of medical services and infrastructure
                in order to sustain the demand that population has. Additionally, we can see these clusters existing around urban hubs and cities.
                This is due to the fact that these urban areas provide the greatest means of accessibility due to improved transportation infrastructure
                    and technology. Additionally, being in urban areas allows for better collaboration among medical professionals, which leads to better
                    care for patients. Overall hospitals are truly important to the well-being of our society and nation. They provide medical
                    services and treatments to individuals and act as an anchor of health infrastructure aimed to serve the public.
                </p>
        </article>

        <article class="scene" data-scene="5">
            <h2>Step 6: Image</h2>
                <img src="img/doctor4.jpg">
        </article>

        <article class="scene fullscreen" data-scene="6">
        </article>
    </section>

    <section id="footer">
        <h2>Hope you Enjoyed!</h2>
    </section>

    <script>
        let map, scriptPanel = scrollama(), countiesLayer, hospitalLayer;
        history.scrollRestoration = "manual";
        window.scrollTo(0, 0);
        adjustStoryboardlSize();
        window.addEventListener("resize", adjustStoryboardlSize);

        function adjustStoryboardlSize() {
            const scenes = document.getElementsByClassName("scene");
            const storyboard = document.getElementById("storyboard");
            let sceneH = Math.floor(window.innerHeight * 0.75);
            for (const scene of scenes) {
                scene.style.height = sceneH + "px";
            }

            let storyboardHeight = window.innerHeight;
            let storyboardMarginTop = (window.innerHeight - storyboardHeight) / 2;
            storyboard.style.height = storyboardHeight + "px";
            storyboard.style.top = storyboardMarginTop + "px"
            scriptPanel.resize();
        }

        mapboxgl.accessToken = 'pk.eyJ1IjoiY3RoMjMiLCJhIjoiY2xzNnRqamx3MHU2YjJqbzc5dnJwZDBwciJ9.TNE4ZpGv__f5i3hTfNPlkQ';
        map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v10',
            zoom: 3,
            minZoom: 2,
            maxZoom: 11,
            center: [-98.5795, 39.8283],
            scrollZoom: false,
            boxZoom: false,
            doubleClickZoom: false
        });

        async function geojsonFetch() {
            let response, hospitals, county;
            response = await fetch("assets/counties.geojson");
            county = await response.json();
            response = await fetch("assets/Hospitals.geojson");
            hospitals = await response.json();

            map.on('load', () => {
                map.addSource('counties-src', {
                    type: 'geojson',
                    data: county
                });

                map.addSource('hospital-src', {
                    type: 'geojson',
                    data: hospitals
                });

                hospitalLayer = {
                    'id': 'hospital_points',
                    'type': 'circle',
                    'source': 'hospital-src',
                    'minzoom': 1,
                    'paint': {
                        'circle-color': '#b30f15',
                        'circle-radius': 2,
                        'circle-opacity': 0.68
                    }
                };
                countiesLayer = {
                    'id': 'counties-polygons',
                    'type': 'fill',
                    'source': 'counties-src',
                    'minzoom': 1,
                    'paint': {
                        'fill-color': '#40c9fe',
                        'fill-opacity': 0.65
                    }
                };

                scriptPanel
                    .setup({
                        step: ".scene",
                        offset: 0.33,
                        debug: false
                    })
                    .onStepEnter(handleSceneEnter)
                    .onStepExit(handleSceneExit);

                function handleSceneEnter(response) {
                    var index = response.index;

                    if (index === 0) {
                        map.flyTo({
                            center: [-98.5795, 39.8283],
                            zoom: 4,
                            pitch: 60,
                            speed: 0.5
                        });

                        if (typeof (map.getSource('counties-src')) == 'undefined') {
                            map.addSource('counties-src', {
                                type: 'geojson',
                                data: county
                            });
                        } else {
                            map.getSource('counties-src').setData(county);
                        }

                        if (!map.getLayer("counties-polygons")) {
                            map.addLayer(countiesLayer);
                        }
                        document.getElementById("cover").style.visibility = "hidden";

                    } else if (index === 1) {
                        map.flyTo({
                            center: [-98.5795, 39.8283],
                            zoom: 3,
                            pitch: 30,
                            speed: 0.5
                        });

                        if (typeof (map.getSource('hospital-src')) == 'undefined') {
                            map.addSource('hospital-src', {
                                type: 'geojson',
                                data: hospitals
                            });
                        } else {
                            map.getSource('hospital-src').setData(hospitals);
                        }

                        if (!map.getLayer("hospital-points")) {
                            map.addLayer(hospitalLayer);
                        }
                    } else if (index === 2) {
                        map.flyTo({
                            center: [-122.3328, 47.6061],
                            zoom: 6,
                            pitch: 0,
                            speed: 0.5
                        });

                        if (typeof (map.getSource('hospital-src')) == 'undefined') {
                            map.addSource('hospital-src', {
                                type: 'geojson',
                                data: hospitals
                            });
                        } else {
                            map.getSource('hospital-src').setData(hospitals);
                        }

                        if (!map.getLayer("hospital-points")) {
                            map.addLayer(hospitalLayer);
                        }

                    } else if (index === 3) {
                        map.flyTo({
                            center: [-119.42, 36.78],
                            zoom: 5,
                            pitch: 0,
                            speed: 0.5
                        });

                    } else if (index === 4) {
                        map.setStyle('mapbox://styles/mapbox/outdoors-v11');
                        map.flyTo({
                            center: [-98, 39],
                            zoom: 2,
                            pitch: 0,
                            speed: 0.5
                        });
                    }
                }
                function handleSceneExit(response) {
                    var index = response.index;
                    if (index === 0) {
                        if (map.getLayer("counties-polygons")) {
                            map.removeLayer('counties-polygons');
                        }
                        if (response.direction == 'down') {
                            document.getElementById("cover").style.visibility = "hidden";
                        } else {
                            document.getElementById("cover").style.visibility = "visible";
                        }
                    } else if (index === 1) {
                    } else if (index === 2) {
                    } else if (index === 3) {
                        map.setStyle('mapbox://styles/mapbox/light-v10');
                    }
                }
            });
        }
        geojsonFetch();
    </script>
</body>

</html>
